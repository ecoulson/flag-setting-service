1. Make message idempotent by creating a map from event id to message id
2. Create a metric root storage which stores the information needed to lookup a metric given its type
3. Store messages after implementing idempotency because then we have a record of all messages